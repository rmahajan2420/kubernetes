#! /bin/bash
INSTANCE_ID=$(curl -S http://169.254.169.254/latest/meta-data/instance-id)
/usr/local/bin/aws ec2 create-tags --region 'us-east-1' --resources $INSTANCE_ID --tags "Key=Name,Value=fame-kubernetes-prod-minion" "Key=Role,Value=fame-kubernetes-prod-minion" "Key=KubernetesCluster,Value=fame-kubernetes-prod"
/bin/mkdir -p /root/.docker
cat > /root/.docker/config.json << EOF_JSON
{
  "auths": {
    "https://hub.docker.com": {
      "auth": "dHRuZGZhbWU6ZmFtZWRlZmF1bHQ="
    },
    "https://index.docker.io/v1/": {
      "auth": "dHRuZGZhbWU6ZmFtZWRlZmF1bHQ="
    }
  }
}
EOF_JSON
mkfs -t ext4 /dev/xvdb
mkdir -p /var/log/app
mount /dev/xvdb /var/log/app
curl -L http://toolbelt.treasuredata.com/sh/install-ubuntu-precise-td-agent2.sh | sh
wget -O /etc/td-agent/td-agent.conf https://s3-ap-southeast-1.amazonaws.com/fameplus-production/kubernetes/kibana/td-agent.conf
service td-agent restart

mkdir -p /var/cache/kubernetes-install
cd /var/cache/kubernetes-install
cat > kube_env.yaml << __EOF_KUBE_ENV_YAML
ENV_TIMESTAMP: '2016-09-07T09:46:00+0000'
INSTANCE_PREFIX: 'fame-kubernetes-prod'
NODE_INSTANCE_PREFIX: 'fame-kubernetes-prod-minion'
NODE_TAGS: ''
CLUSTER_IP_RANGE: '10.244.0.0/16'
SERVER_BINARY_TAR_URL: 'https://s3-ap-southeast-1.amazonaws.com/fame-prod-kubernetes/devel/kubernetes-server-linux-amd64.tar.gz'
SERVER_BINARY_TAR_HASH: '7b89205ccf43a53636b772747549394fa16a44dd'
SALT_TAR_URL: 'https://s3-ap-southeast-1.amazonaws.com/fame-prod-kubernetes/devel/kubernetes-salt.tar.gz'
SALT_TAR_HASH: '4b03e83264eef7c00f80a0f93fade46d378cc35a'
SERVICE_CLUSTER_IP_RANGE: '10.0.0.0/16'
KUBERNETES_MASTER_NAME: 'fame-kubernetes-prod-master'
ALLOCATE_NODE_CIDRS: 'true'
ENABLE_CLUSTER_MONITORING: 'influxdb'
DOCKER_REGISTRY_MIRROR_URL: ''
ENABLE_L7_LOADBALANCING: 'none'
ENABLE_CLUSTER_LOGGING: 'true'
ENABLE_CLUSTER_UI: 'true'
ENABLE_NODE_PROBLEM_DETECTOR: 'false'
ENABLE_NODE_LOGGING: 'true'
LOGGING_DESTINATION: 'elasticsearch'
ELASTICSEARCH_LOGGING_REPLICAS: '1'
ENABLE_CLUSTER_DNS: 'true'
ENABLE_CLUSTER_REGISTRY: 'false'
CLUSTER_REGISTRY_DISK: ''
CLUSTER_REGISTRY_DISK_SIZE: ''
DNS_REPLICAS: '1'
DNS_SERVER_IP: '10.0.0.10'
DNS_DOMAIN: 'cluster.local'
KUBELET_TOKEN: 'NSz5dqRAghD7b1IEI3Mxan5yqGzAHpAe'
KUBE_PROXY_TOKEN: 'PG8Mh75O4ntQobxJSwQE8gssHzj7UMib'
ADMISSION_CONTROL: 'NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,ResourceQuota'
MASTER_IP_RANGE: '10.246.0.0/24'
RUNTIME_CONFIG: ''
CA_CERT: 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURYekNDQWtlZ0F3SUJBZ0lKQU9QK0lJQW8yVWJMTUEwR0NTcUdTSWIzRFFFQkN3VUFNQ1F4SWpBZ0JnTlYKQkFNVUdUVXlMakl5TUM0eE1Ea3VNakUyUURFME56TXlOREUxTWpVd0hoY05NVFl3T1RBM01EazBOVEkxV2hjTgpNall3T1RBMU1EazBOVEkxV2pBa01TSXdJQVlEVlFRREZCazFNaTR5TWpBdU1UQTVMakl4TmtBeE5EY3pNalF4Ck5USTFNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTVONmRaOXJKb1F5U3hreHAKd09UaWptcDh0MEpNdzRmQ1QzZGZ1ZmROTUFtQ055elZxVGJ3elF1RVQrUDBQblA4YjVvSEhla2NWV1dvQy9odQpJYTVYRGErRU0vUTkvNXhydjA4TXNrSGp3eG5QMU5Pall5MkEwSTN1NEpORmc5aEtZR1ZuNGczUlBZcmd3WE5lCjMzWFdJeWkxOUZoRlRGS0szTTd6YndkQUJGTVErL0lzcElYMnp4aHVncEU0OGFmRit4ME41dXlJTmdoQmlyN1EKVHdEVkluU3VqVENQUjlYOVd2bis0Z2ZqVWd2QWNVa0FQRlhKU3R2ZWY4ZVB6ZVh3Y3R0V0NkTWpmVDFnVmdQVgpDQm5lOFpUTHl6SmhpQ1N2aTBJMDMwa2FmRkppYk9MZk9XL3kzWG9WLzhUVUJHVVRUYThraGV1dlljUHk3OFZCCm52QnJZUUlEQVFBQm80R1RNSUdRTUIwR0ExVWREZ1FXQkJRRGIrek5iNFR1NzlXQmU5UVQ3ZTBTVGJkejVEQlUKQmdOVkhTTUVUVEJMZ0JRRGIrek5iNFR1NzlXQmU5UVQ3ZTBTVGJkejVLRW9wQ1l3SkRFaU1DQUdBMVVFQXhRWgpOVEl1TWpJd0xqRXdPUzR5TVRaQU1UUTNNekkwTVRVeU5ZSUpBT1ArSUlBbzJVYkxNQXdHQTFVZEV3UUZNQU1CCkFmOHdDd1lEVlIwUEJBUURBZ0VHTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFDMEU4V3ZxMi94d1VGTjhoQ0UKQ05QYVl6SWx3S0x0TzBEellwMVNSbHlGMUlBYThEbm1HOFJLUjBOUU0xMlBDSW9nMGxLK3VHdFlWd3VJMS8wdApvQis1MEphYThxVVpscmJiekp1dnBSTGNLS0J5ZHhWME1HeEJNOU1lUlY4UFBwbmZhcVU5SUwwMHN2M0JMZ0dUCmFKSTk1NWg0eFlydS9wM1RoSVozTlZQeUd4d1NUUkhmVFp1Wi9MRTh0R3ZGTW82b3g5UjMvOWZ6K2Z3YWF4ZUMKTFJyalcxMlh3d2hJUjIySW14S1J6elI3bnB6QXI3MWJsaE15ZlN3TEd6QlhSTlovdER4OWJERjRBenpZZHJTawo5R3N6M1NwMnplT3B3czRoVUtIcTJmUjl0eExBTmE2eWV5UUYyVWFvbExWdjRoQ3FjNCtXSk9qbXQ5dTNxeC9GClJncXAKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo='
KUBELET_CERT: 'Q2VydGlmaWNhdGU6CiAgICBEYXRhOgogICAgICAgIFZlcnNpb246IDMgKDB4MikKICAgICAgICBTZXJpYWwgTnVtYmVyOiAyICgweDIpCiAgICBTaWduYXR1cmUgQWxnb3JpdGhtOiBzaGEyNTZXaXRoUlNBRW5jcnlwdGlvbgogICAgICAgIElzc3VlcjogQ049NTIuMjIwLjEwOS4yMTZAMTQ3MzI0MTUyNQogICAgICAgIFZhbGlkaXR5CiAgICAgICAgICAgIE5vdCBCZWZvcmU6IFNlcCAgNyAwOTo0NToyNSAyMDE2IEdNVAogICAgICAgICAgICBOb3QgQWZ0ZXIgOiBTZXAgIDUgMDk6NDU6MjUgMjAyNiBHTVQKICAgICAgICBTdWJqZWN0OiBDTj1rdWJlbGV0CiAgICAgICAgU3ViamVjdCBQdWJsaWMgS2V5IEluZm86CiAgICAgICAgICAgIFB1YmxpYyBLZXkgQWxnb3JpdGhtOiByc2FFbmNyeXB0aW9uCiAgICAgICAgICAgICAgICBQdWJsaWMtS2V5OiAoMjA0OCBiaXQpCiAgICAgICAgICAgICAgICBNb2R1bHVzOgogICAgICAgICAgICAgICAgICAgIDAwOjlmOjRiOjZlOjk0OjMwOmQzOmNiOjUwOmY4OmNmOjhhOmY5OmIzOjk0OgogICAgICAgICAgICAgICAgICAgIDU0OmMyOjZlOmJlOmE1OmNlOjYyOmU3OjhjOjY0OjEzOmIwOmVjOjVhOjQwOgogICAgICAgICAgICAgICAgICAgIGZiOjkyOjdkOmY3OjZhOjM0OmU0OmQwOjUzOjk4Ojg0OjgyOjU1OmMyOjY2OgogICAgICAgICAgICAgICAgICAgIGRkOjg4Ojc0OjVkOmRlOjUwOjg5OjA3OmE2OjZkOjNkOmFlOjFmOmRjOjgyOgogICAgICAgICAgICAgICAgICAgIDEyOjFkOjcwOmFmOjM4OmQyOmI0OjIyOmMzOmE2OjM5OmRiOmM4OmY1OjVjOgogICAgICAgICAgICAgICAgICAgIDU2OjFiOjFlOjYwOmUzOmUwOjRmOjE3OjMzOjVhOmI5OmUwOjExOjQzOjg5OgogICAgICAgICAgICAgICAgICAgIGZhOjk0OjdkOmFmOjFiOmJlOjAxOmMwOjlkOmU1OmY0OjU2OmFlOmM1OmNkOgogICAgICAgICAgICAgICAgICAgIGQzOjMyOjY2OjBiOjc1OmQ2OjhhOjEyOmQ0OjBmOmY4OmVjOmFkOmMzOmMzOgogICAgICAgICAgICAgICAgICAgIGQ1OmZmOjk3OjM2OmM0OjRjOmM1OjE5OjExOjk0OjMwOjczOmFjOjllOjJjOgogICAgICAgICAgICAgICAgICAgIDcwOmY3OjFmOjAzOmJiOjQzOjE5OmM0OmRhOmMzOjZjOmYzOjBkOjEwOjU0OgogICAgICAgICAgICAgICAgICAgIDQ0OmE4OmQzOmI4OmU0OjI4OjhhOmY0OjgzOjVmOmM1OjUzOjMwOjQ4OjQzOgogICAgICAgICAgICAgICAgICAgIDdmOmI2OjlhOjQ3OjU2OjA1OjE0OmUyOmRiOjZkOjJhOmFkOjFiOjQwOmI5OgogICAgICAgICAgICAgICAgICAgIDUxOmNiOjE3OmYwOjNhOjM1OmJlOjM5OjJmOjBkOjhiOjhiOmNlOmYwOjIyOgogICAgICAgICAgICAgICAgICAgIGYwOjc5OmE2OjM4Ojk1OmRhOmU5OjM3OjRmOjhhOjBlOjVhOjI4OjMwOjI2OgogICAgICAgICAgICAgICAgICAgIGNjOmQxOjQzOjBhOjNkOmRmOmZiOmJjOjVmOmMwOmNkOmY0Ojg2OjkyOjA0OgogICAgICAgICAgICAgICAgICAgIDAwOmUwOmZjOmMyOmJiOjNhOmI4OjYwOjAyOjNhOjMyOjBkOjA5OjkwOmEwOgogICAgICAgICAgICAgICAgICAgIDIzOjRmOjdkOjE5Ojc2OjNkOjNiOjBmOjM4OjJkOjMyOjJkOjRkOjUyOmI0OgogICAgICAgICAgICAgICAgICAgIGRmOjkxCiAgICAgICAgICAgICAgICBFeHBvbmVudDogNjU1MzcgKDB4MTAwMDEpCiAgICAgICAgWDUwOXYzIGV4dGVuc2lvbnM6CiAgICAgICAgICAgIFg1MDl2MyBCYXNpYyBDb25zdHJhaW50czogCiAgICAgICAgICAgICAgICBDQTpGQUxTRQogICAgICAgICAgICBYNTA5djMgU3ViamVjdCBLZXkgSWRlbnRpZmllcjogCiAgICAgICAgICAgICAgICBDQzo5QTozRjpCMjpFQzo2NDozMzoyRToyNzpCQjo3MToxMzo4Nzo4RjowQzozMTo1MzpDRjpEMDo3NQogICAgICAgICAgICBYNTA5djMgQXV0aG9yaXR5IEtleSBJZGVudGlmaWVyOiAKICAgICAgICAgICAgICAgIGtleWlkOjAzOjZGOkVDOkNEOjZGOjg0OkVFOkVGOkQ1OjgxOjdCOkQ0OjEzOkVEOkVEOjEyOjREOkI3OjczOkU0CiAgICAgICAgICAgICAgICBEaXJOYW1lOi9DTj01Mi4yMjAuMTA5LjIxNkAxNDczMjQxNTI1CiAgICAgICAgICAgICAgICBzZXJpYWw6RTM6RkU6MjA6ODA6Mjg6RDk6NDY6Q0IKCiAgICAgICAgICAgIFg1MDl2MyBFeHRlbmRlZCBLZXkgVXNhZ2U6IAogICAgICAgICAgICAgICAgVExTIFdlYiBDbGllbnQgQXV0aGVudGljYXRpb24KICAgICAgICAgICAgWDUwOXYzIEtleSBVc2FnZTogCiAgICAgICAgICAgICAgICBEaWdpdGFsIFNpZ25hdHVyZQogICAgU2lnbmF0dXJlIEFsZ29yaXRobTogc2hhMjU2V2l0aFJTQUVuY3J5cHRpb24KICAgICAgICAgY2Y6ZDA6YWQ6ZTU6MWI6ZWY6Y2Y6YTc6OTE6ZGU6YTI6Yzk6Njk6MWU6NDA6ZTg6YTk6ZWY6CiAgICAgICAgIGY5OmJiOjhlOjIyOmZjOjIwOjM3OmVmOjdlOjYyOmI2OjE5OjM5OmY1OmM3OjZjOjc2OmQ3OgogICAgICAgICBhNzplNTphYjpjYjplMDpkNDowZjpmMTpjZDo3YzoyMzoyOToxMDo1MTo1NTpmYjo0YTozNjoKICAgICAgICAgZGI6MzU6ZmQ6ZDc6MjU6ZWI6NGI6YWU6YmU6YzE6OWQ6MTQ6ZGU6ZjE6YzY6YmU6ZjM6ZDM6CiAgICAgICAgIDEwOjU0OjgxOjRmOmY1Ojc0OmMwOjRlOmZjOjk3OmJhOjcyOmMyOjNkOjdkOmNiOjViOmJhOgogICAgICAgICA5ZTphMDozMzoxNTo2YzpkNzphZjo2YTplNzoyZTo4ODo4YToyNjo3Mjo5YzoyYToyODpjMjoKICAgICAgICAgYjU6MTE6MjM6NGY6MDQ6MWQ6ZGE6NGU6MTY6NTI6Yzc6MDY6MWM6MWM6NDg6ZTc6NzI6NDU6CiAgICAgICAgIDE2OmI0OmRiOmQxOmM3OjlkOjgzOjA5OmY5OjNkOjBhOjBjOmYzOjkzOmE0OjI4OjFiOmU1OgogICAgICAgICA5YjowZTo5ZTo1YTo5OTpkNjo2YjpjMzplOToxZDozMjo5YTphZjo3MTo5ODo5NDowNTo3MjoKICAgICAgICAgZTY6YWI6Njk6NGM6MGQ6Zjk6NmI6ODA6M2M6MDI6YmI6MDk6NWY6NDg6Y2I6NDY6Yjc6OTY6CiAgICAgICAgIDY1OmFhOmNmOjVmOjRhOjBjOjFlOmY0OjNjOmZhOmE3OmFlOmRhOjU3OmQ5OmI0OmNkOjY0OgogICAgICAgICBiNjo5YTo4ZDplMzo2YTozNzpkOTo5OTpkYTo0NDo5ZTphYjoyNTpiOTpjMDo2Yjo3Zjo3NDoKICAgICAgICAgZjY6MWU6MDc6YTI6Mzk6OTc6MmU6Yzc6ZmU6MTA6Yzc6MWM6NjI6OWU6NmE6ZDc6ZTI6ZGM6CiAgICAgICAgIDczOjdlOmNkOmYxOmRlOmNiOjRmOmJlOjAzOmUxOjk2OjNlOmVmOjhmOjE5OjU2OjE3OjdiOgogICAgICAgICA1NDpjYzo4MTpjNQotLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS0KTUlJRFZ6Q0NBaitnQXdJQkFnSUJBakFOQmdrcWhraUc5dzBCQVFzRkFEQWtNU0l3SUFZRFZRUURGQmsxTWk0eQpNakF1TVRBNUxqSXhOa0F4TkRjek1qUXhOVEkxTUI0WERURTJNRGt3TnpBNU5EVXlOVm9YRFRJMk1Ea3dOVEE1Ck5EVXlOVm93RWpFUU1BNEdBMVVFQXhNSGEzVmlaV3hsZERDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVAKQURDQ0FRb0NnZ0VCQUo5TGJwUXcwOHRRK00rSytiT1VWTUp1dnFYT1l1ZU1aQk93N0ZwQSs1Sjk5Mm8wNU5CVAptSVNDVmNKbTNZaDBYZDVRaVFlbWJUMnVIOXlDRWgxd3J6alN0Q0xEcGpuYnlQVmNWaHNlWU9QZ1R4Y3pXcm5nCkVVT0orcFI5cnh1K0FjQ2Q1ZlJXcnNYTjB6Sm1DM1hXaWhMVUQvanNyY1BEMWYrWE5zUk14UmtSbERCenJKNHMKY1BjZkE3dERHY1RhdzJ6ekRSQlVSS2pUdU9Rb2l2U0RYOFZUTUVoRGY3YWFSMVlGRk9MYmJTcXRHMEM1VWNzWAo4RG8xdmprdkRZdUx6dkFpOEhtbU9KWGE2VGRQaWc1YUtEQW16TkZEQ2ozZis3eGZ3TTMwaHBJRUFPRDh3cnM2CnVHQUNPaklOQ1pDZ0kwOTlHWFk5T3c4NExUSXRUVkswMzVFQ0F3RUFBYU9CcFRDQm9qQUpCZ05WSFJNRUFqQUEKTUIwR0ExVWREZ1FXQkJUTW1qK3k3R1F6TGllN2NST0hqd3d4VTgvUWRUQlVCZ05WSFNNRVRUQkxnQlFEYit6TgpiNFR1NzlXQmU5UVQ3ZTBTVGJkejVLRW9wQ1l3SkRFaU1DQUdBMVVFQXhRWk5USXVNakl3TGpFd09TNHlNVFpBCk1UUTNNekkwTVRVeU5ZSUpBT1ArSUlBbzJVYkxNQk1HQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01DTUFzR0ExVWQKRHdRRUF3SUhnREFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBejlDdDVSdnZ6NmVSM3FMSmFSNUE2S252K2J1TwpJdndnTis5K1lyWVpPZlhIYkhiWHArV3J5K0RVRC9ITmZDTXBFRkZWKzBvMjJ6WDkxeVhyUzY2K3daMFUzdkhHCnZ2UFRFRlNCVC9WMHdFNzhsN3B5d2oxOXkxdTZucUF6Rld6WHIycm5Mb2lLSm5LY0tpakN0UkVqVHdRZDJrNFcKVXNjR0hCeEk1M0pGRnJUYjBjZWRnd241UFFvTTg1T2tLQnZsbXc2ZVdwbldhOFBwSFRLYXIzR1lsQVZ5NXF0cApUQTM1YTRBOEFyc0pYMGpMUnJlV1phclBYMG9NSHZROCtxZXUybGZadE0xa3RwcU40Mm8zMlpuYVJKNnJKYm5BCmEzOTA5aDRIb2ptWExzZitFTWNjWXA1cTErTGNjMzdOOGQ3TFQ3NEQ0WlkrNzQ4WlZoZDdWTXlCeFE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=='
KUBELET_KEY: 'LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRQ2ZTMjZVTU5QTFVQalAKaXZtemxGVENicjZsem1MbmpHUVRzT3hhUVB1U2ZmZHFOT1RRVTVpRWdsWENadDJJZEYzZVVJa0hwbTA5cmgvYwpnaElkY0s4NDByUWl3Nlk1MjhqMVhGWWJIbURqNEU4WE0xcTU0QkZEaWZxVWZhOGJ2Z0hBbmVYMFZxN0Z6ZE15ClpndDExb29TMUEvNDdLM0R3OVgvbHpiRVRNVVpFWlF3YzZ5ZUxIRDNId083UXhuRTJzTnM4dzBRVkVTbzA3amsKS0lyMGcxL0ZVekJJUTMrMm1rZFdCUlRpMjIwcXJSdEF1VkhMRi9BNk5iNDVMdzJMaTg3d0l2QjVwamlWMnVrMwpUNG9PV2lnd0pzelJRd285My91OFg4RE45SWFTQkFEZy9NSzdPcmhnQWpveURRbVFvQ05QZlJsMlBUc1BPQzB5CkxVMVN0TitSQWdNQkFBRUNnZ0VCQUlobFdvWGhXVGlhV0xHOVdobitSS1ZIbGs3NjdZMCtsT0tYZDRuQVlxa0kKMnpWQm5Uc1VtVis5Q2htdllybFlpcGUxZGQvckRWYm5KYmoyVnZTR2JFTEhpQjdNVUNUeW9Kd1hPRk40SzVaegpsc1ZTMzdpUXQ3ZVJDZExqMjNCeHZhWmtqV1l1WXZCVVVTYXlZZFhBb2ZHRlN6ZmwwTlB6ZCtXbVlPcXNvWWZZClAyZ1Z2Uy91ejd1ZWhYdDNVbFZtTXhzVHA2ZGdKMXJsT25yWWM1QlhmZ3lqakdqbDl2Vzd6SFVHRk81Y0RwV1AKY2dnWmQ2anlzbHdTemw3T25RUDVXU0FUeUFRaUtISGJsK1kvcVlwOWdwTURmL0xmTDhQMlloOTBDQWc3cGM4eAplSVliQmJ3ZVpaNjVJbHQ5YnB3RkVVL2hpbDBZVWhYWDVlc1ZjNTlwL01FQ2dZRUEwZi9ybHlPcmJSMm1CTllNCjdsSUVnL3BiUTFGQ1RzY0plbHpGWFJPd3FISnZ5eVMyY3ZCOXAvTm1PelhqUnR4dkVEN1hXTnM1TjZBM0JwYWwKOUtsUXdvNG9vQkRkYWlWWUptSXA0RFNrMDU2SVR2SnR3WTN0VFVUZ3dqT1c1WDY4M055UXBvODAvWkRubkJmagpqZWdhRURQeXlHblAzcnFkaTNydzBEYU52SzBDZ1lFQXdqQWtwU3haSUdvbWF6bGl0R1ZaYVZ0MTBQVnVlN0xECk1ieWFiRU9qenR6dEs5SDBKcmxLQ0JzMGNCS3R2Nkt2Titya2dvMC9YWDdNM3dHcytUR0xKdFh3YkYyUi9LMzgKNHVkdS9Bd21YdzhadmlwUGVtcXY5U2FjaWs3TmRodFVHUmExY3Zzd3UyeWdLMDA5S2JmeDF6dGFCYm8xUlROVQpPM296SzRCWVJ2VUNnWUVBelFIbEVXQmVHeURsa1RVUjNKcXZFOVNWd2FzVGEycDlnem9MNXFpeFBsQ3hlSVMzCnBJL0lhK3grOGZEU2xydmRwT05rUWJlS0xSYTRnVE1TZ2ozRXZKb2hhTm50L1pERmRIdENYRUdvWTNzUm9OaWsKYzE5RnViZ3pId05VSFdqVG9WMmx6U1JpMitQWlo1WWVyTXRZbmxiSWZnUm1UUTZyZko0aGQzSzZmZVVDZ1lBRgoxeExURU9GaFV5L3ltNWczV3JEMHRUWjI0VnJBUjZFTk51SGlEYXE0aHZadkVmSm8wN3ZCUUtnMEVxdTlEclI4ClZ3a21ULzh1M2FobHNKUTJMbUpEK2Iwd1ZTUVYyRm01clVJdVBHTlBDcEk0b09jaEJHSmtXaFB0S08rTzlNVnoKdDdZZlRpU3FEbHRHMGh6YnkxZHZwSzVSYThjOFhJM1UrQmpmM3cxSW5RS0JnRUVRQjZOM3kxb0ZScHBDbGFvbwpjMkM4V3diR2t4T3FHbDRjdDc5ODFPeldmeE5STkV3dzU0Zlp2R2VKc0Z1em8rTlZtWE91Q1dCbHBxTGlQUXlUClI0dDlaaVVhb05tK0JkV0pPN21sU0pPT2l6eUUyTFJGYkVjZ0NhNVQxSEJySTdlZWV5TGJMdG8yUFI1MldyWXYKL3gzTk5WNWVnVGNzV09Dc2RrR0ZMUC91Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K'
NETWORK_PROVIDER: 'none'
PREPULL_E2E_IMAGES: ''
HAIRPIN_MODE: ''
OPENCONTRAIL_TAG: 'R2.20'
OPENCONTRAIL_KUBERNETES_TAG: 'master'
OPENCONTRAIL_PUBLIC_SUBNET: '10.1.0.0/16'
E2E_STORAGE_TEST_ENVIRONMENT: 'false'
KUBE_IMAGE_TAG: ''
KUBE_DOCKER_REGISTRY: ''
KUBE_ADDON_REGISTRY: ''
MULTIZONE: ''
NON_MASQUERADE_CIDR: '10.0.0.0/8'
KUBE_UID: '3798999130'
KUBERNETES_MASTER: 'false'
ZONE: 'ap-southeast-1a'
EXTRA_DOCKER_OPTS: ''
AUTO_UPGRADE: 'true'
DOCKER_STORAGE: 'aufs'
API_SERVERS: '172.31.16.9'
__EOF_KUBE_ENV_YAML

wget -O bootstrap https://s3-ap-southeast-1.amazonaws.com/fame-prod-kubernetes/devel/bootstrap-script
chmod +x bootstrap
mkdir -p /etc/kubernetes
mv kube_env.yaml /etc/kubernetes
mv bootstrap /etc/kubernetes/
cat > /etc/rc.local << EOF_RC_LOCAL
#!/bin/sh -e
/etc/kubernetes/bootstrap
/bin/cp /root/.docker/config.json /var/lib/kubelet/
mount /dev/xvdb /var/log/app
exit 0
EOF_RC_LOCAL
/etc/kubernetes/bootstrap