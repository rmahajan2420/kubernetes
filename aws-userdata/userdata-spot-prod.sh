#! /bin/bash
INSTANCE_ID=$(curl -S http://169.254.169.254/latest/meta-data/instance-id)
/usr/local/bin/aws ec2 create-tags --region 'ap-southeast-1' --resources $INSTANCE_ID --tags "Key=Name,Value=fame-kubernetes-prod-minion-spot" "Key=Role,Value=fame-kubernetes-prod-minion" "Key=KubernetesCluster,Value=fame-kubernetes-prod"
/bin/mkdir -p /root/.docker
cat > /root/.docker/config.json << EOF_JSON
{
  "auths": {
    "https://hub.docker.com": {
      "auth": "dHRuZGZhbWU6ZmFtZWRlZmF1bHQ="
    },
    "https://index.docker.io/v1/": {
      "auth": "dHRuZGZhbWU6ZmFtZWRlZmF1bHQ="
    }
  }
}
EOF_JSON
mkfs -t ext4 /dev/xvdba
mkdir -p /var/log/app
mount /dev/xvdba /var/log/app
curl -L http://toolbelt.treasuredata.com/sh/install-ubuntu-precise-td-agent2.sh | sh
wget -O /etc/td-agent/td-agent.conf https://s3-ap-southeast-1.amazonaws.com/fameplus-production/kubernetes/kibana/td-agent.conf
service td-agent restart
wget https://s3-ap-southeast-1.amazonaws.com/fameplus-production/kubernetes/auto_alarms/autoalarms.sh -O-| sudo bash

mkdir -p /var/cache/kubernetes-install
cd /var/cache/kubernetes-install
cat > kube_env.yaml << __EOF_KUBE_ENV_YAML
ENV_TIMESTAMP: '2016-09-14T09:23:20+0000'
INSTANCE_PREFIX: 'fame-kubernetes-aws'
NODE_INSTANCE_PREFIX: 'fame-kubernetes-aws-minion'
NODE_TAGS: ''
CLUSTER_IP_RANGE: '10.244.0.0/16'
SERVER_BINARY_TAR_URL: 'https://s3-ap-southeast-1.amazonaws.com/fame-prod-kubernetes/devel/kubernetes-server-linux-amd64.tar.gz'
SERVER_BINARY_TAR_HASH: '7b89205ccf43a53636b772747549394fa16a44dd'
SALT_TAR_URL: 'https://s3-ap-southeast-1.amazonaws.com/fame-prod-kubernetes/devel/kubernetes-salt.tar.gz'
SALT_TAR_HASH: '4b03e83264eef7c00f80a0f93fade46d378cc35a'
SERVICE_CLUSTER_IP_RANGE: '10.0.0.0/16'
KUBERNETES_MASTER_NAME: 'fame-kubernetes-aws-master'
ALLOCATE_NODE_CIDRS: 'true'
ENABLE_CLUSTER_MONITORING: 'influxdb'
DOCKER_REGISTRY_MIRROR_URL: ''
ENABLE_L7_LOADBALANCING: 'none'
ENABLE_CLUSTER_LOGGING: 'false'
ENABLE_CLUSTER_UI: 'true'
ENABLE_NODE_PROBLEM_DETECTOR: 'false'
ENABLE_NODE_LOGGING: 'false'
LOGGING_DESTINATION: 'elasticsearch'
ELASTICSEARCH_LOGGING_REPLICAS: '1'
ENABLE_CLUSTER_DNS: 'true'
ENABLE_CLUSTER_REGISTRY: 'false'
CLUSTER_REGISTRY_DISK: ''
CLUSTER_REGISTRY_DISK_SIZE: ''
DNS_REPLICAS: '1'
DNS_SERVER_IP: '10.0.0.10'
DNS_DOMAIN: 'livfame.local'
KUBELET_TOKEN: 'Tfqn4aW7vOnjgA1UQnhaavN4Ng8Mhq8p'
KUBE_PROXY_TOKEN: 'qYrI1idTeYvWLZt78jDuVRkPYQV1Sxri'
ADMISSION_CONTROL: 'NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,ResourceQuota'
MASTER_IP_RANGE: '10.246.0.0/24'
RUNTIME_CONFIG: ''
CA_CERT: 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURYRENDQWtTZ0F3SUJBZ0lKQU4wS2VtYjF2VkJwTUEwR0NTcUdTSWIzRFFFQkN3VUFNQ014SVRBZkJnTlYKQkFNTUdEVXlMakl5TUM0eE1UZ3VOamhBTVRRM016ZzBORGsyTURBZUZ3MHhOakE1TVRRd09USXlOREJhRncweQpOakE1TVRJd09USXlOREJhTUNNeElUQWZCZ05WQkFNTUdEVXlMakl5TUM0eE1UZ3VOamhBTVRRM016ZzBORGsyCk1EQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUt5WDZsaThodXdOdnBWQzF2NzYKNkF4ZlhoRFRhK1VGWU5hN25oMSt1QkdMczVwSnBIRDgyNS9SWk9SRXBudnV6VVc1YVF0VWwxVnhTaVljY1J0dgpBSkFhSFZjeXBlQWF1U2tqM3BmeTc1d2d4bGxWTVZKUzcxeWNvaysrd3lPOTQ5UU42VytlTWVudyt1U3QwUC9PCnc3RVM5UUwzVzVtcVZXVHVRS05mY2cwaCtBTEdOL20wVFU5MHVKMDFkanJsS3RDYmttK0FCWXkzVytWdEZMemsKWDdHd0Z3Z2kwZ0xyeXl4R1p5U1BEUEJiLzlnQkgrdUVBUVdybzR4YkFJT1VRcTNFTCtZMlUvVEM3Qk5OVi9yVgpDaWRFM3o5cGptYXphZHdaYUVqUE9aRjU2a2gwVzFDbTc2Z0c1TVVGUlYxZDFKOW9xVUxXenNxRU82USsvTUtJCit0a0NBd0VBQWFPQmtqQ0JqekFkQmdOVkhRNEVGZ1FVa3ZUU2JQMTRiR3IxVjdnQ3NKbkR2aGxkaE9Rd1V3WUQKVlIwakJFd3dTb0FVa3ZUU2JQMTRiR3IxVjdnQ3NKbkR2aGxkaE9TaEo2UWxNQ014SVRBZkJnTlZCQU1NR0RVeQpMakl5TUM0eE1UZ3VOamhBTVRRM016ZzBORGsyTUlJSkFOMEtlbWIxdlZCcE1Bd0dBMVVkRXdRRk1BTUJBZjh3CkN3WURWUjBQQkFRREFnRUdNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUFSR0RqYmc1MUxqWWdZbDlTbVlHVmIKY0xvWWpROXZ4QndzMkZGcWZVWU5DVWloRDNMTzRwSERSUXZsUzQ0U3EvZEwyM0ErQS82SFIvcWRXVk9iTjYwMgpTNk9SWVJRV3Y0ZUVDQWdNdmFXZFFjUjJWWHdoN05oQ3I5dDdOSExJa1JieWxhOTcwNVMvWVAvM1pCUHc4OHVRClA3R3FiQWdOMXZFbW1vVmJSeE1IU2ROcDVqWTM5SUdiVDBKNFV5aWF3czFkTFpLOFpvRGJma3UyaWVrUjJEZ3IKODNFZGlqcnpFbjJQclJzVk1FQ1RUbkliaXljdDBrL3M5QnB2WjVRZnY1V290WVNwaTBPcTYzV3ptcFpIRmQ3eQpPQUIxZUg3QjEvcE1NNWZkQ3RBcFduWDFJbkE1QytPWFc5dDhpZk5CRlVYaGpDaXVzY0xRRE1DZzd4UWJkNE1iCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K'
KUBELET_CERT: 'Q2VydGlmaWNhdGU6CiAgICBEYXRhOgogICAgICAgIFZlcnNpb246IDMgKDB4MikKICAgICAgICBTZXJpYWwgTnVtYmVyOiAyICgweDIpCiAgICBTaWduYXR1cmUgQWxnb3JpdGhtOiBzaGEyNTZXaXRoUlNBRW5jcnlwdGlvbgogICAgICAgIElzc3VlcjogQ049NTIuMjIwLjExOC42OEAxNDczODQ0OTYwCiAgICAgICAgVmFsaWRpdHkKICAgICAgICAgICAgTm90IEJlZm9yZTogU2VwIDE0IDA5OjIyOjQwIDIwMTYgR01UCiAgICAgICAgICAgIE5vdCBBZnRlciA6IFNlcCAxMiAwOToyMjo0MCAyMDI2IEdNVAogICAgICAgIFN1YmplY3Q6IENOPWt1YmVsZXQKICAgICAgICBTdWJqZWN0IFB1YmxpYyBLZXkgSW5mbzoKICAgICAgICAgICAgUHVibGljIEtleSBBbGdvcml0aG06IHJzYUVuY3J5cHRpb24KICAgICAgICAgICAgICAgIFB1YmxpYy1LZXk6ICgyMDQ4IGJpdCkKICAgICAgICAgICAgICAgIE1vZHVsdXM6CiAgICAgICAgICAgICAgICAgICAgMDA6Y2Y6ZGM6ZmE6ZTU6NWY6MmY6NWQ6ZGM6OTE6OTU6OTc6ZTQ6OWI6ZTU6CiAgICAgICAgICAgICAgICAgICAgNmY6OWM6ZmE6MWU6MTU6Y2M6ZjE6YzU6YTI6MGM6MTY6NjY6MDY6ZWM6YTc6CiAgICAgICAgICAgICAgICAgICAgOTI6M2I6NmQ6NTc6OGM6MzA6NTQ6MDY6MzI6N2Q6MWY6MWQ6ZmM6M2Y6OGY6CiAgICAgICAgICAgICAgICAgICAgZTk6MTM6ZDI6NGU6NWE6NmM6YjM6Mjc6MGU6Mzk6MjI6MDQ6NmI6MDM6NzE6CiAgICAgICAgICAgICAgICAgICAgNmY6OTM6MzE6OTM6Y2Q6NDc6N2I6M2E6OTk6MDA6NDU6NjA6M2U6MDU6NmE6CiAgICAgICAgICAgICAgICAgICAgOTM6ZGE6NGY6YzU6ZmQ6NTg6OTE6ZmQ6ZjU6ZmI6Y2E6YTk6ZWU6NjY6MjE6CiAgICAgICAgICAgICAgICAgICAgY2I6YWE6ZTU6MTQ6OWU6ZTg6Nzk6OWM6ZjE6MmU6MDA6ZTk6ZDU6YzE6ZDI6CiAgICAgICAgICAgICAgICAgICAgYzc6YjY6ZGM6YzI6ZTk6NWU6MzU6MzU6Mzg6YmE6MDY6NTU6ZmI6MDM6MGM6CiAgICAgICAgICAgICAgICAgICAgOGE6NTI6OGI6NTU6YzY6NWE6Zjk6MzY6Y2E6OTc6MGQ6MmI6Yjk6Zjk6ZWM6CiAgICAgICAgICAgICAgICAgICAgMDQ6OTY6NTk6Yjg6YjY6MzM6YjQ6Zjk6MTc6NWE6MGQ6OWE6ZDM6NjM6YTE6CiAgICAgICAgICAgICAgICAgICAgZWU6OTI6MWU6Mjc6MmM6N2E6Njc6NzQ6YTA6ZWQ6Nzc6MDc6MGY6ZmI6ZGE6CiAgICAgICAgICAgICAgICAgICAgYzk6OWE6YTc6Mjg6ZDM6ZTk6OTE6YTY6MmM6MWY6MTU6M2M6NWE6MWE6YzY6CiAgICAgICAgICAgICAgICAgICAgOGQ6YTk6MDE6MjU6YTY6NDc6MTA6ZGY6YWM6OTk6Nzg6NTY6Nzg6NGI6YTY6CiAgICAgICAgICAgICAgICAgICAgMDI6YTU6MmI6ZGU6MzU6YzE6YzY6MmQ6YmM6MjE6ODg6YzU6ZmU6N2M6MDM6CiAgICAgICAgICAgICAgICAgICAgNDk6MzA6MDE6MjA6NTY6Mzg6NDU6NDY6ZTI6YmU6NjY6OGI6ZWY6Y2E6NDI6CiAgICAgICAgICAgICAgICAgICAgMWY6NDY6Mzk6Y2I6NGY6YjU6OWU6NDU6ZjQ6MzQ6NDA6NmE6NTU6NDA6NzI6CiAgICAgICAgICAgICAgICAgICAgNjE6OGY6NWE6YmE6M2Q6ZDc6MjQ6NzE6NGY6NzE6Mzg6NjA6ZmI6ZGI6ZjA6CiAgICAgICAgICAgICAgICAgICAgNGM6OGIKICAgICAgICAgICAgICAgIEV4cG9uZW50OiA2NTUzNyAoMHgxMDAwMSkKICAgICAgICBYNTA5djMgZXh0ZW5zaW9uczoKICAgICAgICAgICAgWDUwOXYzIEJhc2ljIENvbnN0cmFpbnRzOiAKICAgICAgICAgICAgICAgIENBOkZBTFNFCiAgICAgICAgICAgIFg1MDl2MyBTdWJqZWN0IEtleSBJZGVudGlmaWVyOiAKICAgICAgICAgICAgICAgIEY0OjMzOkYxOjk5OkUzOjgxOkZGOjk2OkY1OkQ0OjJDOjdFOkJEOkNBOjQ3OjEwOjAwOkM1Ojg4OjY2CiAgICAgICAgICAgIFg1MDl2MyBBdXRob3JpdHkgS2V5IElkZW50aWZpZXI6IAogICAgICAgICAgICAgICAga2V5aWQ6OTI6RjQ6RDI6NkM6RkQ6Nzg6NkM6NkE6RjU6NTc6Qjg6MDI6QjA6OTk6QzM6QkU6MTk6NUQ6ODQ6RTQKICAgICAgICAgICAgICAgIERpck5hbWU6L0NOPTUyLjIyMC4xMTguNjhAMTQ3Mzg0NDk2MAogICAgICAgICAgICAgICAgc2VyaWFsOkREOjBBOjdBOjY2OkY1OkJEOjUwOjY5CgogICAgICAgICAgICBYNTA5djMgRXh0ZW5kZWQgS2V5IFVzYWdlOiAKICAgICAgICAgICAgICAgIFRMUyBXZWIgQ2xpZW50IEF1dGhlbnRpY2F0aW9uCiAgICAgICAgICAgIFg1MDl2MyBLZXkgVXNhZ2U6IAogICAgICAgICAgICAgICAgRGlnaXRhbCBTaWduYXR1cmUKICAgIFNpZ25hdHVyZSBBbGdvcml0aG06IHNoYTI1NldpdGhSU0FFbmNyeXB0aW9uCiAgICAgICAgIDUyOmNjOjgwOjFiOjFkOjdiOjQxOjQ5OjA4OmEwOjVmOjA4OmU1OjI0OjA4OmM3OjFhOmY2OgogICAgICAgICBjYTphOTo0OTpjYjpjMDoxMDo1NzowYToyODo5MjozMDpjMzowMjpiMjo1ZDo4ODo3MzoxYjoKICAgICAgICAgOTU6MTc6ZWY6MTk6ZjM6YTg6MWI6NTk6MGU6MmI6Njg6YTY6YmY6OTA6NDk6NTc6NGY6MGM6CiAgICAgICAgIDU1OjA1OmMyOjQ0OjM4OmZmOjRlOjdkOjYyOjUwOjUwOmQ5OjczOjZkOjNkOjY4Ojc1OjUyOgogICAgICAgICBmYzo4YTozZTpkYzpkNDpiZTpjZDpiMzoyYjo1ODpiYjplMTpiODpjNTo0Mzo5YjoxZDplZToKICAgICAgICAgMDc6NTE6ZDI6MjA6MTY6OGY6YWI6NzE6YWE6ZmY6NjQ6NTY6YmE6MGM6ZDY6YmY6MGY6NTE6CiAgICAgICAgIDNmOjNjOjU4OjNmOmZhOmMxOjNhOmZhOjM4Ojk4OjZmOjI3OjhmOmZiOmY2OjE5OjI2OmU3OgogICAgICAgICBkZjo5NTpjMjo1Yzo2MTpiNjo4ODoxODpjYzozZDo3YzoyYTo1MjpiZjo2NzpkNzo4MzpkZDoKICAgICAgICAgMzA6Y2E6ZTQ6MTQ6NTA6OTU6MjE6YmU6MDc6ZjU6ZTk6ZjM6ZmU6NWU6YjM6Mjg6OGE6Mjc6CiAgICAgICAgIGZiOjA2OjRiOmUwOjAzOjI1OjRlOmEyOmI0OmFmOjQ3OmFjOjM1OmM2OjBkOjY3OmQzOjhmOgogICAgICAgICAwODoxMDplYTo0NTphZDo5YzphYTo0Yjo1ZjphYjowZTo3MDpkYTowNzphZjo4Mjo1OTo1NjoKICAgICAgICAgYjA6M2Y6NjQ6MTY6YjA6Njk6ZTA6OTY6YTg6NDY6ZGE6YWI6NDI6ZDc6ZTY6YzE6NmM6MWE6CiAgICAgICAgIDc0OmMzOmJiOmUwOjkzOjRjOmQ2OjMwOjZmOjM1OjkyOjgzOjZkOjQzOjYzOmRiOjQ1OjJhOgogICAgICAgICBkMjpjNTozNDpkMjpiMDpiZDo1ZDplMjo1MjoxMDpiODo2YjpiZTpmZTo0MTo3NjplOTphYToKICAgICAgICAgYTQ6NGQ6MTY6ZDYKLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURWVENDQWoyZ0F3SUJBZ0lCQWpBTkJna3Foa2lHOXcwQkFRc0ZBREFqTVNFd0h3WURWUVFEREJnMU1pNHkKTWpBdU1URTRMalk0UURFME56TTRORFE1TmpBd0hoY05NVFl3T1RFME1Ea3lNalF3V2hjTk1qWXdPVEV5TURreQpNalF3V2pBU01SQXdEZ1lEVlFRRERBZHJkV0psYkdWME1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBCk1JSUJDZ0tDQVFFQXo5ejY1Vjh2WGR5UmxaZmttK1Z2blBvZUZjenh4YUlNRm1ZRzdLZVNPMjFYakRCVUJqSjkKSHgzOFA0L3BFOUpPV215ekp3NDVJZ1JyQTNGdmt6R1R6VWQ3T3BrQVJXQStCV3FUMmsvRi9WaVIvZlg3eXFudQpaaUhMcXVVVW51aDVuUEV1QU9uVndkTEh0dHpDNlY0MU5UaTZCbFg3QXd5S1VvdFZ4bHI1TnNxWERTdTUrZXdFCmxsbTR0ak8wK1JkYURaclRZNkh1a2g0bkxIcG5kS0R0ZHdjUCs5ckptcWNvMCttUnBpd2ZGVHhhR3NhTnFRRWwKcGtjUTM2eVplRlo0UzZZQ3BTdmVOY0hHTGJ3aGlNWCtmQU5KTUFFZ1ZqaEZSdUsrWm92dnlrSWZSam5MVDdXZQpSZlEwUUdwVlFISmhqMXE2UGRja2NVOXhPR0Q3Mi9CTWl3SURBUUFCbzRHa01JR2hNQWtHQTFVZEV3UUNNQUF3CkhRWURWUjBPQkJZRUZQUXo4Wm5qZ2YrVzlkUXNmcjNLUnhBQXhZaG1NRk1HQTFVZEl3Uk1NRXFBRkpMMDBtejkKZUd4cTlWZTRBckNadzc0WlhZVGtvU2VrSlRBak1TRXdId1lEVlFRRERCZzFNaTR5TWpBdU1URTRMalk0UURFMApOek00TkRRNU5qQ0NDUURkQ25wbTliMVFhVEFUQmdOVkhTVUVEREFLQmdnckJnRUZCUWNEQWpBTEJnTlZIUThFCkJBTUNCNEF3RFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUZMTWdCc2RlMEZKQ0tCZkNPVWtDTWNhOXNxcFNjdkEKRUZjS0tKSXd3d0t5WFloekc1VVg3eG56cUJ0WkRpdG9wcitRU1ZkUERGVUZ3a1E0LzA1OVlsQlEyWE50UFdoMQpVdnlLUHR6VXZzMnpLMWk3NGJqRlE1c2Q3Z2RSMGlBV2o2dHhxdjlrVnJvTTFyOFBVVDg4V0QvNndUcjZPSmh2Cko0Lzc5aGttNTkrVndseGh0b2dZekQxOEtsSy9aOWVEM1RESzVCUlFsU0crQi9YcDgvNWVzeWlLSi9zR1MrQUQKSlU2aXRLOUhyRFhHRFdmVGp3Z1E2a1d0bktwTFg2c09jTm9IcjRKWlZyQS9aQmF3YWVDV3FFYmFxMExYNXNGcwpHblREdStDVFROWXdieldTZzIxRFk5dEZLdExGTk5Ld3ZWM2lVaEM0YTc3K1FYYnBxcVJORnRZPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=='
KUBELET_KEY: 'LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRFAzUHJsWHk5ZDNKR1YKbCtTYjVXK2MraDRWelBIRm9nd1daZ2JzcDVJN2JWZU1NRlFHTW4wZkhmdy9qK2tUMGs1YWJMTW5EamtpQkdzRApjVytUTVpQTlIzczZtUUJGWUQ0RmFwUGFUOFg5V0pIOTlmdktxZTVtSWN1cTVSU2U2SG1jOFM0QTZkWEIwc2UyCjNNTHBYalUxT0xvR1Zmc0RESXBTaTFYR1d2azJ5cGNOSzduNTdBU1dXYmkyTTdUNUYxb05tdE5qb2U2U0hpY3MKZW1kMG9PMTNCdy83MnNtYXB5alQ2WkdtTEI4VlBGb2F4bzJwQVNXbVJ4RGZySmw0Vm5oTHBnS2xLOTQxd2NZdAp2Q0dJeGY1OEEwa3dBU0JXT0VWRzRyNW1pKy9LUWg5R09jdFB0WjVGOURSQWFsVkFjbUdQV3JvOTF5UnhUM0U0CllQdmI4RXlMQWdNQkFBRUNnZ0VBRVA5QjZPV3FxdU14YUdrZVFYMDJia0NwbXlEQ0dHWVMxUFlNMU9jeTl2Y08KOUtDekRqcXNycEcySWNCeno3SWZ4QmNsWXlrdmxNK0ZyS2RtOTBOVGtiS3BxZlgrNXExakJQQmRITG52TjdNNQpaT25yWi93VFNYaXovY3B6c0RiVVV2Z0p5ZnRWQmw5bEExZnovRDgrM0paQjUraTUrTnJhcUx0S0RVazlIYlMzCmdIdDVMWlpITnBZbm5laWhQNEpPWVppd1lRYy9mUWNzWmpOcWpmM3QxZE9tUWFvL2dLUlh5WXRUVlNsMWg1dnEKejdhdHViMXJWWUw5YWZJby9maGl5TW9oTUl6ZVQ2U05QTFVKdHFpTEZycFRJN2N3cDhJTXNmMHcvNjAveFFFSwpvVVNDd3F4ckNGckdxdDVzYWZ2ZVcyWHBvVkRMRTZCYzRqdHhNMGRnR1FLQmdRRHA4WVgzdDJYZ0ppVzlXWUlvClBHQnNKWG5Hc2FDS2srYlVQMWNORHJSVDJjczBGbTJPcmxpNEgwSnhYNFppUHRtZ1R1SE1tWDhBRGlRYndxZ3QKTnVpd2ZCbU9hUmtOTVRhMFU4NVRLbTRjSHMxOTR2WHJ4R3Y4bEk3L0dxbXVOUWdTeXJKTXAxOWFINnRSVE5WUwovYjdCc0FnM1hEVmhBT2t6MEJFSjk4TDRKd0tCZ1FEamRmdGhDM2lWeloreG1oMDNVVTBIT3NTZG1IZGJxdmdPClQ0RnNsRHoxSjBRcXYrY3Q0eGdhNm52KzNJTWVlZTNjS1NwSlZDV3BENWdYNUo4Q2lMdEdmUm4vYzdrUUpUbDcKNzdMdTZoczZjSEVWUzMvWG5JTTR5WXgvckVXayt2eHhXN1VwWVE0eDljSnBvZVFPQ2xIR2FQdWR0NThxUko3MwpaVlhBanVGQy9RS0JnRzRsK3ViVW9oSDB4Q1l3STdsZ0hDSXZUdlAvcEZBN0xSN1lKOXVOQmRqSkhnVUxYbEFrCnhMOEVjTnRDbDlwZ0wwVnNmcUkvejIwdU8xQWF5ZVpvQ1EwM2tTemRUUjlLQWJETUdNUk5vUVI2ZUZTQ2JUbXkKQlFvcXhGMVdwM2ZQbmxxQ3Q0cWg3NkpXY09wWm04TjBsOEZJYWNYdkUyNzE1OWN1YXlkZlVaeFhBb0dCQUk0bQpoSlF3ZEFyQ3Q2TnBtZ3FoSDQ5K0ZiUWJ2YlFuRStEMXBQK3pZS2toQWdQcGJGT01FZHQ0WVVkMGplajA4RWJmCjN4SjJxUmFQclZCNVN6cHRNd1NwV0I4Q05reTF4c2dDbEFPbGdLQ3o5cWdGUi83NlRET29HY3NNWVhYcWVPdHIKRWJ1cmNSQ2Q4d0xLN3RncmNOR2JlR3duZml3UE9IMko4ZDVtTExjTkFvR0JBTnlLN1BVWVRjV1RvMzJjV2wyUQpCUWY5T2ZIeEdIUU0xVHEzcFZva045YmNGREFXRHhxNDZCcDBMQzR2RFoxYzI2QlNrNXlzOXg1VVlLMVNMcnF4CjRWN09veFphSitHcGE3TzNKZFBRbVlJUmFLM1VmYXR1Z21hd2NzMVJzZFcvK3NhSTV3eWpMVVptT1VhZjZOWkEKVEk1aFdsMUpUT2p3dm5yY3EybmRxWGJDCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K'
NETWORK_PROVIDER: 'none'
PREPULL_E2E_IMAGES: ''
HAIRPIN_MODE: ''
OPENCONTRAIL_TAG: 'R2.20'
OPENCONTRAIL_KUBERNETES_TAG: 'master'
OPENCONTRAIL_PUBLIC_SUBNET: '10.1.0.0/16'
E2E_STORAGE_TEST_ENVIRONMENT: 'false'
KUBE_IMAGE_TAG: ''
KUBE_DOCKER_REGISTRY: ''
KUBE_ADDON_REGISTRY: ''
MULTIZONE: ''
NON_MASQUERADE_CIDR: '10.0.0.0/8'
KUBE_UID: '3768426350'
KUBERNETES_MASTER: 'false'
ZONE: 'ap-southeast-1a'
EXTRA_DOCKER_OPTS: ''
AUTO_UPGRADE: 'true'
DOCKER_STORAGE: 'aufs'
API_SERVERS: '172.31.16.9'
NODE_LABELS: 'node=spot'
__EOF_KUBE_ENV_YAML

wget -O bootstrap https://s3-ap-southeast-1.amazonaws.com/fame-prod-kubernetes/devel/bootstrap-script
chmod +x bootstrap
mkdir -p /etc/kubernetes
mv kube_env.yaml /etc/kubernetes
mv bootstrap /etc/kubernetes/
cat > /etc/rc.local << EOF_RC_LOCAL
#!/bin/sh -e
/etc/kubernetes/bootstrap
/bin/cp /root/.docker/config.json /var/lib/kubelet/
mount /dev/xvdba /var/log/app
exit 0
EOF_RC_LOCAL
/etc/kubernetes/bootstrap
